trigger oppoTrigger on Opportunity (before update, After UPDATE) {
    if (Trigger.IsBefore && Trigger.isUpdate) {
		for (Opportunity opp:Trigger.New) {
 			if ((Trigger.oldMap.get(opp.Id).StageName != 'Closed Won' ||  Trigger.oldMap.get(opp.Id).StageName != 'Closed Won') && (opp.StageName == 'Closed Won' || opp.StageName == 'Closed Lost')) {
				opp.CloseDate = System.Today();
			}
		}
	}
    if(Trigger.IsAfter && Trigger.IsUpdate){
        Set<Id> oppoSet = new Set<Id>();
        for(Opportunity opp : trigger.new){
            if(opp.custom_status__c == 'Reset'){
                oppoSet.add(opp.id);
            }
        }
        if(oppoSet != null && oppoSet.size() > 0){
            List<OpportunityLineItem> listDelete = new List<OpportunityLineItem>();
            for(Opportunity oppp :[Select Id,(Select id from OpportunityLineItems) From Opportunity Where Id In: oppoSet] ){
                if(oppp.OpportunityLineItems != Null && oppp.OpportunityLineItems.size() > 0){
                    listDelete.addAll(oppp.OpportunityLineItems);
                }
            }
            if(listDelete != null && listDelete.size() > 0){
                DELETE listDelete;
            }
        }
    }
}
